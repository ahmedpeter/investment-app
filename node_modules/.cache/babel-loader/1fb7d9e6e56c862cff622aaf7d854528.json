{"ast":null,"code":"import _regeneratorRuntime from\"/Users/muhammedmusa/Documents/Other-Projects/globaltrade/investment-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/muhammedmusa/Documents/Other-Projects/globaltrade/investment-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import axios from'axios';import jwt_decode from'jwt-decode';import dayjs from'dayjs';var BASE_URL='https://dry-falls-41890.herokuapp.com/api/v1/';var authTokens=localStorage.getItem('authTokens')?JSON.parse(localStorage.getItem('authTokens')):null;var axiosInstance=axios.create({BASE_URL:BASE_URL,headers:{Authorization:\"Bearer \".concat(authTokens===null||authTokens===void 0?void 0:authTokens.accessToken)}});axiosInstance.interceptors.request.use(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(req){var user,isExpired,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!authTokens){// authTokens = localStorage.getItem('authTokens') ? JSON.parse(localStorage.getItem('authTokens'))\nreq.headers.Authorization=\"Bearer \".concat(authTokens===null||authTokens===void 0?void 0:authTokens.accessToken);}user=jwt_decode(authTokens.accessToken);isExpired=dayjs.unix(user.exp).diff(dayjs())<1;if(!isExpired){_context.next=5;break;}return _context.abrupt(\"return\",req);case 5:_context.next=7;return axios.post(\"\".concat(BASE_URL,\"/token\"),{refreshToken:authTokens.refreshToken});case 7:response=_context.sent;localStorage.setItem('authTokens',JSON.stringify(response.data));req.headers.Authorization=\"Bearer \".concat(authTokens===null||authTokens===void 0?void 0:authTokens.accessToken);return _context.abrupt(\"return\",req);case 11:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}());export default axiosInstance;","map":{"version":3,"sources":["/Users/muhammedmusa/Documents/Other-Projects/globaltrade/investment-app/src/Util/axiosInstance.js"],"names":["axios","jwt_decode","dayjs","BASE_URL","authTokens","localStorage","getItem","JSON","parse","axiosInstance","create","headers","Authorization","accessToken","interceptors","request","use","req","user","isExpired","unix","exp","diff","post","refreshToken","response","setItem","stringify","data"],"mappings":"yXAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,UAAP,KAAuB,YAAvB,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CAGA,GAAMC,CAAAA,QAAQ,CAAI,+CAAlB,CAGA,GAAIC,CAAAA,UAAU,CAAGC,YAAY,CAACC,OAAb,CAAqB,YAArB,EAAqCC,IAAI,CAACC,KAAL,CAAWH,YAAY,CAACC,OAAb,CAAqB,YAArB,CAAX,CAArC,CAAqF,IAAtG,CAEA,GAAMG,CAAAA,aAAa,CAAGT,KAAK,CAACU,MAAN,CAAa,CAC/BP,QAAQ,CAARA,QAD+B,CAE/BQ,OAAO,CAAE,CAAEC,aAAa,kBAAYR,UAAZ,SAAYA,UAAZ,iBAAYA,UAAU,CAAES,WAAxB,CAAf,CAFsB,CAAb,CAAtB,CAMAJ,aAAa,CAACK,YAAd,CAA2BC,OAA3B,CAAmCC,GAAnC,0FAAuC,iBAAMC,GAAN,8IACnC,GAAG,CAACb,UAAJ,CAAe,CACX;AACAa,GAAG,CAACN,OAAJ,CAAYC,aAAZ,kBAAsCR,UAAtC,SAAsCA,UAAtC,iBAAsCA,UAAU,CAAES,WAAlD,EACH,CACKK,IAL6B,CAKtBjB,UAAU,CAACG,UAAU,CAACS,WAAZ,CALY,CAM7BM,SAN6B,CAMjBjB,KAAK,CAACkB,IAAN,CAAWF,IAAI,CAACG,GAAhB,EAAqBC,IAArB,CAA0BpB,KAAK,EAA/B,EAAqC,CANpB,KAOhCiB,SAPgC,yDAOdF,GAPc,+BASZjB,CAAAA,KAAK,CAACuB,IAAN,WAAcpB,QAAd,WAAgC,CACnDqB,YAAY,CAAEpB,UAAU,CAACoB,YAD0B,CAAhC,CATY,QAS7BC,QAT6B,eAanCpB,YAAY,CAACqB,OAAb,CAAqB,YAArB,CAAmCnB,IAAI,CAACoB,SAAL,CAAeF,QAAQ,CAACG,IAAxB,CAAnC,EACAX,GAAG,CAACN,OAAJ,CAAYC,aAAZ,kBAAsCR,UAAtC,SAAsCA,UAAtC,iBAAsCA,UAAU,CAAES,WAAlD,EAdmC,gCAgB5BI,GAhB4B,yDAAvC,gEAuBA,cAAeR,CAAAA,aAAf","sourcesContent":["import axios from 'axios';\nimport jwt_decode from 'jwt-decode';\nimport dayjs from 'dayjs';\n\n\nconst BASE_URL =  'https://dry-falls-41890.herokuapp.com/api/v1/';\n\n\nlet authTokens = localStorage.getItem('authTokens') ? JSON.parse(localStorage.getItem('authTokens')): null;\n\nconst axiosInstance = axios.create({\n    BASE_URL,\n    headers: { Authorization: `Bearer ${authTokens?.accessToken}` }\n});\n\n\naxiosInstance.interceptors.request.use(async req => {\n    if(!authTokens){\n        // authTokens = localStorage.getItem('authTokens') ? JSON.parse(localStorage.getItem('authTokens'))\n        req.headers.Authorization = `Bearer ${authTokens?.accessToken}`\n    }\n    const user = jwt_decode(authTokens.accessToken)\n    const isExpired = dayjs.unix(user.exp).diff(dayjs()) < 1;\n    if(isExpired) return req\n\n    const response = await axios.post(`${BASE_URL}/token`, {\n        refreshToken: authTokens.refreshToken\n    });\n\n    localStorage.setItem('authTokens', JSON.stringify(response.data))\n    req.headers.Authorization = `Bearer ${authTokens?.accessToken}`\n\n    return req;\n\n\n    \n})\n\n\nexport default axiosInstance;"]},"metadata":{},"sourceType":"module"}