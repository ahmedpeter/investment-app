{"ast":null,"code":"import axios, { AxiosError, AxiosInstance, AxiosRequestConfig, AxiosResponse } from \"axios\"; //   import Router from \"next/router\";\n\nconst API_URL = \"https://dry-falls-41890.herokuapp.com/api/v1\";\n\nconst onRequest = config => {\n  const token = localStorage.getItem(\"accessToken\");\n  config.headers[\"Authorization\"] = `Bearer ${token.accessToken}`;\n  console.log(token);\n  return config;\n};\n\nconst onRequestError = error => {\n  return Promise.reject(error);\n  console.log('i am here');\n};\n\nconst onResponse = response => {\n  return response;\n  console.log(response);\n};\n\nconst onResponseError = async error => {\n  if (error.response) {\n    // Access Token was expired\n    if (error.response.status === 401 && error.response.data.message === \"jwt expired\") {\n      const storedToken = JSON.parse(localStorage.getItem(\"token\"));\n\n      try {\n        const res = await axios.post(`${API_URL}/token`, {\n          refreshToken: storedToken.refreshToken\n        });\n        const {\n          token,\n          user\n        } = res.data;\n        localStorage.setItem(\"token\", JSON.stringify(token));\n        localStorage.setItem(\"user\", JSON.stringify(user));\n        return;\n      } catch (_error) {\n        return Promise.reject(_error);\n      }\n    }\n  }\n\n  return Promise.reject(error);\n};\n\nexport const setupInterceptorsTo = axiosInstance => {\n  axiosInstance.interceptors.request.use(onRequest, onRequestError);\n  axiosInstance.interceptors.response.use(onResponse, onResponseError);\n  return axiosInstance;\n};","map":{"version":3,"sources":["/Users/primalaero/investment/src/Util/Interceptors.js"],"names":["axios","AxiosError","AxiosInstance","AxiosRequestConfig","AxiosResponse","API_URL","onRequest","config","token","localStorage","getItem","headers","accessToken","console","log","onRequestError","error","Promise","reject","onResponse","response","onResponseError","status","data","message","storedToken","JSON","parse","res","post","refreshToken","user","setItem","stringify","_error","setupInterceptorsTo","axiosInstance","interceptors","request","use"],"mappings":"AAAA,OAAOA,KAAP,IACEC,UADF,EAEEC,aAFF,EAGEC,kBAHF,EAIEC,aAJF,QAKO,OALP,C,CAMA;;AAEE,MAAMC,OAAO,GAAG,8CAAhB;;AAEA,MAAMC,SAAS,GAAIC,MAAD,IAAY;AAC5B,QAAMC,KAAK,GAAGC,YAAY,CAACC,OAAb,CAAqB,aAArB,CAAd;AACAH,EAAAA,MAAM,CAACI,OAAP,CAAe,eAAf,IAAmC,UAASH,KAAK,CAACI,WAAY,EAA9D;AACAC,EAAAA,OAAO,CAACC,GAAR,CAAYN,KAAZ;AACA,SAAOD,MAAP;AACD,CALD;;AAOA,MAAMQ,cAAc,GAAIC,KAAD,IAAW;AAChC,SAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;AACAH,EAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ;AACD,CAHD;;AAKA,MAAMK,UAAU,GAAIC,QAAD,IAAc;AAC/B,SAAOA,QAAP;AACAP,EAAAA,OAAO,CAACC,GAAR,CAAYM,QAAZ;AACD,CAHD;;AAKA,MAAMC,eAAe,GAAG,MAAOL,KAAP,IAAiB;AACvC,MAAIA,KAAK,CAACI,QAAV,EAAoB;AAClB;AACA,QACEJ,KAAK,CAACI,QAAN,CAAeE,MAAf,KAA0B,GAA1B,IACAN,KAAK,CAACI,QAAN,CAAeG,IAAf,CAAoBC,OAApB,KAAgC,aAFlC,EAGE;AACA,YAAMC,WAAW,GAAGC,IAAI,CAACC,KAAL,CAAWlB,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAX,CAApB;;AAEA,UAAI;AACF,cAAMkB,GAAG,GAAG,MAAM5B,KAAK,CAAC6B,IAAN,CAAY,GAAExB,OAAQ,QAAtB,EAA+B;AAC/CyB,UAAAA,YAAY,EAAEL,WAAW,CAACK;AADqB,SAA/B,CAAlB;AAIA,cAAM;AAAEtB,UAAAA,KAAF;AAASuB,UAAAA;AAAT,YAAkBH,GAAG,CAACL,IAA5B;AAEAd,QAAAA,YAAY,CAACuB,OAAb,CAAqB,OAArB,EAA8BN,IAAI,CAACO,SAAL,CAAezB,KAAf,CAA9B;AACAC,QAAAA,YAAY,CAACuB,OAAb,CAAqB,MAArB,EAA6BN,IAAI,CAACO,SAAL,CAAeF,IAAf,CAA7B;AAEA;AACD,OAXD,CAWE,OAAOG,MAAP,EAAe;AACf,eAAOjB,OAAO,CAACC,MAAR,CAAegB,MAAf,CAAP;AACD;AACF;AACF;;AACD,SAAOjB,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;AACD,CA1BD;;AA4BA,OAAO,MAAMmB,mBAAmB,GAAKC,aAAF,IAAqB;AACtDA,EAAAA,aAAa,CAACC,YAAd,CAA2BC,OAA3B,CAAmCC,GAAnC,CAAuCjC,SAAvC,EAAkDS,cAAlD;AACAqB,EAAAA,aAAa,CAACC,YAAd,CAA2BjB,QAA3B,CAAoCmB,GAApC,CAAwCpB,UAAxC,EAAoDE,eAApD;AACA,SAAOe,aAAP;AACD,CAJM","sourcesContent":["import axios, {\n  AxiosError,\n  AxiosInstance,\n  AxiosRequestConfig,\n  AxiosResponse,\n} from \"axios\";\n//   import Router from \"next/router\";\n  \n  const API_URL = \"https://dry-falls-41890.herokuapp.com/api/v1\";\n  \n  const onRequest = (config) => {\n    const token = localStorage.getItem(\"accessToken\"); \n    config.headers[\"Authorization\"] = `Bearer ${token.accessToken}`;\n    console.log(token);\n    return config;\n  };\n  \n  const onRequestError = (error) => {\n    return Promise.reject(error);\n    console.log('i am here')\n  };\n  \n  const onResponse = (response) => {\n    return response;\n    console.log(response)\n  };\n  \n  const onResponseError = async (error) => {\n    if (error.response) {\n      // Access Token was expired\n      if (\n        error.response.status === 401 &&\n        error.response.data.message === \"jwt expired\"\n      ) {\n        const storedToken = JSON.parse(localStorage.getItem(\"token\"));\n  \n        try {\n          const res = await axios.post(`${API_URL}/token`, {\n            refreshToken: storedToken.refreshToken,\n          });\n  \n          const { token, user } = res.data;\n  \n          localStorage.setItem(\"token\", JSON.stringify(token));\n          localStorage.setItem(\"user\", JSON.stringify(user));\n  \n          return;\n        } catch (_error) {\n          return Promise.reject(_error);\n        }\n      }\n    }\n    return Promise.reject(error);\n  };\n  \n  export const setupInterceptorsTo = ( axiosInstance ) => {\n    axiosInstance.interceptors.request.use(onRequest, onRequestError);\n    axiosInstance.interceptors.response.use(onResponse, onResponseError);\n    return axiosInstance;\n  };"]},"metadata":{},"sourceType":"module"}