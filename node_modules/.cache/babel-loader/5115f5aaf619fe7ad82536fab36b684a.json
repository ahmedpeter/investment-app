{"ast":null,"code":"import _regeneratorRuntime from\"/Users/muhammedmusa/Documents/Other-Projects/globaltrade/investment-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/muhammedmusa/Documents/Other-Projects/globaltrade/investment-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/muhammedmusa/Documents/Other-Projects/globaltrade/investment-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';import{createContext,useState,useEffect}from'react-dom';import jwt_decode from\"jwt-decode\";import{useHistory}from'react-router-dom';//  const AuthContext = createContext();\nimport{jsx as _jsx}from\"react/jsx-runtime\";var AuthContext=/*#__PURE__*/React.createContext();export default AuthContext;export var AuthProvider=function AuthProvider(_ref){var children=_ref.children;var _useState=useState(function(){return localStorage.getItem('authTokens')?JSON.parse(localStorage.getItem('authTokens')):null;}),_useState2=_slicedToArray(_useState,2),authTokens=_useState2[0],setAuthTokens=_useState2[1];var _useState3=useState(function(){return localStorage.getItem('authTokens')?jwt_decode(localStorage.getItem('authTokens')):null;}),_useState4=_slicedToArray(_useState3,2),user=_useState4[0],setUser=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var history=useHistory();var logOutUser=function logOutUser(){setAuthTokens(null);setUser(null);localStorage.removeItem('authTokens');history.push('/login');};var updateToken=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return fetch('https://dry-falls-41890.herokuapp.com/api/v1/token',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({'refresh':authTokens===null||authTokens===void 0?void 0:authTokens.refreshToken})});case 2:response=_context.sent;_context.next=5;return response.json();case 5:data=_context.sent;if(response.status===200){setAuthTokens(data);setUser(jwt_decode(data.accessToken));localStorage.setItem('authTokens',JSON.stringify(data));}else{logOutUser();}if(loading){setLoading(false);}case 8:case\"end\":return _context.stop();}}},_callee);}));return function updateToken(){return _ref2.apply(this,arguments);};}();var contextData={user:user,authTokens:authTokens,// loginUser:loginUser,\nlogOutUser:logOutUser};useEffect(function(){if(loading){updateToken();}var fiveMinutes=1000*60*5;var interval=setInterval(function(){if(authTokens){updateToken();}},fiveMinutes);return function(){return clearInterval(interval);};},[authTokens,loading]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:contextData,children:loading?null:children});};","map":{"version":3,"sources":["/Users/muhammedmusa/Documents/Other-Projects/globaltrade/investment-app/src/Util/AuthContext.js"],"names":["React","createContext","useState","useEffect","jwt_decode","useHistory","AuthContext","AuthProvider","children","localStorage","getItem","JSON","parse","authTokens","setAuthTokens","user","setUser","loading","setLoading","history","logOutUser","removeItem","push","updateToken","fetch","method","headers","body","stringify","refreshToken","response","json","data","status","accessToken","setItem","contextData","fiveMinutes","interval","setInterval","clearInterval"],"mappings":"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","sourcesContent":["import React from 'react';\n import { createContext, useState, useEffect} from 'react-dom';\n import jwt_decode from \"jwt-decode\";\n import {useHistory } from 'react-router-dom';\n\n\n\n//  const AuthContext = createContext();\n const AuthContext = React.createContext();\n\n export default AuthContext;\n\n export const AuthProvider = ({children})=>{\n     let [authTokens, setAuthTokens] = useState(()=>localStorage.getItem('authTokens') ? JSON.parse(localStorage.getItem('authTokens')): null)\n     let [user, setUser] = useState(()=>localStorage.getItem('authTokens') ? jwt_decode(localStorage.getItem('authTokens')): null);\n    let [loading, setLoading]  = useState(true);\n\n    const history = useHistory();\n\n    let logOutUser = () => {\n        setAuthTokens(null)\n        setUser(null)\n        localStorage.removeItem('authTokens')\n        history.push('/login')\n    }\n\n\n    let updateToken = async ()=> {\n        let response = await fetch('https://dry-falls-41890.herokuapp.com/api/v1/token', {\n            method: 'POST',\n            headers: { \n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({'refresh': authTokens?.refreshToken})\n        })\n\n        let data = await response.json()\n        if(response.status === 200){\n            setAuthTokens(data)\n            setUser(jwt_decode(data.accessToken))\n            localStorage.setItem('authTokens', JSON.stringify(data))\n        }else {\n            logOutUser()\n        }\n\n        if(loading){\n            setLoading(false);\n        }\n    }\n\n    let contextData = {\n        user:user,\n        authTokens: authTokens,\n        // loginUser:loginUser,\n        logOutUser:logOutUser\n    }\n\n\n    useEffect(()=> {\n        if(loading){\n            updateToken()\n        }\n        let fiveMinutes = 1000 * 60 * 5\n        let interval = setInterval(()=>{\n            if(authTokens){\n                updateToken()\n            }\n        }, fiveMinutes)\n        return ()=> clearInterval(interval)\n    }, [authTokens, loading])\n\n    return(\n        <AuthContext.Provider value={contextData} >\n            {loading ? null : children }\n        </AuthContext.Provider>\n    )\n\n\n\n\n    }"]},"metadata":{},"sourceType":"module"}